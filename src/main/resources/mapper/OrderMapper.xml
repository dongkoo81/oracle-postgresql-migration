<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.autoever.mes.mapper.OrderMapper">

    <!-- Stored Procedure: CALCULATE_ORDER_TOTAL -->
    <select id="calculateOrderTotal" statementType="CALLABLE">
        {CALL CALCULATE_ORDER_TOTAL(
            #{orderId, mode=IN, jdbcType=NUMERIC},
            #{result.totalAmount, mode=OUT, jdbcType=NUMERIC}
        )}
    </select>

    <!-- Stored Function: CHECK_PRODUCT_AVAILABLE -->
    <select id="checkProductAvailable" resultType="java.lang.Integer">
        SELECT CHECK_PRODUCT_AVAILABLE(#{productId}, #{requiredQty}) FROM DUAL
    </select>

    <!-- Stored Function: GET_PRODUCT_STATUS (DECODE 사용) -->
    <select id="getProductStatus" resultType="java.lang.String">
        SELECT GET_PRODUCT_STATUS(#{productId}) AS status FROM DUAL
    </select>

    <!-- Stored Procedure: MERGE_INVENTORY (MERGE 문 사용) -->
    <update id="mergeInventory" statementType="CALLABLE">
        {CALL MERGE_INVENTORY(
            #{productId, mode=IN, jdbcType=NUMERIC},
            #{quantity, mode=IN, jdbcType=NUMERIC}
        )}
    </update>

    <!-- TO_DATE 테스트: 날짜 범위 검색 -->
    <select id="findOrdersByDateRange" resultType="java.util.HashMap">
        SELECT 
            ORDER_ID as orderId,
            ORDER_NO as orderNo,
            ORDER_DATE as orderDate,
            TOTAL_AMOUNT as totalAmount
        FROM PRODUCTION_ORDER
        WHERE ORDER_DATE BETWEEN TO_DATE(#{startDate}, 'YYYY-MM-DD') AND TO_DATE(#{endDate}, 'YYYY-MM-DD')
        ORDER BY ORDER_DATE DESC
    </select>

</mapper>
